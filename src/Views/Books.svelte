<script lang='ts' ✂prettier:content✂="CiAgICBpbXBvcnQgQ2VudHJlU3RhZ2UgZnJvbSAnLi4vVmlld3MvQ2VudHJlU3RhZ2Uuc3ZlbHRlJwogICAgaW1wb3J0IEJvb2tsZXQgZnJvbSAnLi4vU3R1ZmYvQm9va2xldCcKICAgIGltcG9ydCBDb3VudGVyIGZyb20gJy4uL1N0dWZmL0NvdW50ZXInCiAgICBpbXBvcnQgeyBmZXRjaEJvb2sgfSBmcm9tICcuLi93b3JrZXJzL2dpc3RQYXJzZXInCiAgICBpbXBvcnQgeyB3YXRjaFJlc2l6ZSB9IGZyb20gJ3N2ZWx0ZS13YXRjaC1yZXNpemUnCiAgICBpbXBvcnQgeyBvbk1vdW50IH0gZnJvbSAnc3ZlbHRlJwogICAgaW1wb3J0IHsgY3ViaWNJbk91dCB9IGZyb20gJ3N2ZWx0ZS9lYXNpbmcnCiAgICBpbXBvcnQgeyB0d2VlbmVkIH0gZnJvbSAnc3ZlbHRlL21vdGlvbicKICAgIGltcG9ydCB7IGZhZGUgfSBmcm9tICdzdmVsdGUvdHJhbnNpdGlvbicKICAgIGltcG9ydCB7IFN3aXBlciwgU3dpcGVyU2xpZGUgfSBmcm9tICdzd2lwZXIvc3ZlbHRlJwogICAgaW1wb3J0IHsgTW91c2V3aGVlbCwgS2V5Ym9hcmQgfSBmcm9tICdzd2lwZXInCiAgICBpbXBvcnQgJ3N3aXBlci9jc3MnCiAgICBpbXBvcnQgJy4uLy4uL3B1YmxpYy9zb3VyY2VGb250LmNzcycKCiAgICBpbnRlcmZhY2UgQm9va09uU2hlbGYgewogICAgICAgIGJvb2s6IFRIUkVFLk9iamVjdDNEPFRIUkVFLkV2ZW50PgogICAgICAgIHRhcGU/OiBUSFJFRS5PYmplY3QzRDxUSFJFRS5FdmVudD4KICAgIH0KCiAgICBsZXQgbG9hZGluZyA9IHRydWUKICAgIGxldCBib29rU2hlbGYgPSBuZXcgQXJyYXk8Qm9va09uU2hlbGY+KCkKICAgIGxldCBpdGVtQnVmZmVyID0gbmV3IEFycmF5PFRIUkVFLk9iamVjdDNEPFRIUkVFLkV2ZW50Pj4oKQogICAgbGV0IGNvdW50ZXJCdWZmZXI6IFRIUkVFLk9iamVjdDNEPFRIUkVFLkV2ZW50PltdID0gW10KICAgIGxldCBzY3JvbGxlcnM6IG51bWJlcltdID0gW10KICAgIGxldCBzY3JvbGxpbmdCbG9ja3M6IEhUTUxFbGVtZW50W10gPSBbXQogICAgbGV0IHN0YWdlOiBDZW50cmVTdGFnZQogICAgY29uc3QgZmluZU9mZnNldCA9IHR3ZWVuZWQoMCwgewogICAgICAgIGR1cmF0aW9uOiAyMDAwLAogICAgICAgIGVhc2luZzogY3ViaWNJbk91dCwKICAgIH0pCiAgICBmaW5lT2Zmc2V0LnN1YnNjcmliZSgodmFsdWUpID0+IHsKICAgICAgICBoYW5kbGVTd2l0Y2godmFsdWUpCiAgICB9KQogICAgY29uc3QgU3BhY2VyID0gMSAvIDQKCiAgICBsZXQgZmlndXJlOiBDb3VudGVyCgogICAgJDogaW5uZXJXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoCiAgICAkOiBpbm5lckhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodAoKICAgICQ6IG91dHRhU2NhbGUgPSBjb3VudGVyQnVmZmVyCiAgICAgICAgLmZpbHRlcigoeCwgaSkgPT4gaSAlIDMgPT09IDEpCiAgICAgICAgLm1hcCgoZW50cnksIGluZGV4KSA9PgogICAgICAgICAgICBNYXRoLm1heCgwLCAxIC0gc2Nyb2xsZXJzW2luZGV4XSAvIChpbm5lckhlaWdodCAvIDIwKSksCiAgICAgICAgKQoKICAgIGZ1bmN0aW9uIGNsYW1wKHZhbHVlOiBudW1iZXIsIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcikgewogICAgICAgIHJldHVybiBNYXRoLm1heChtaW4sIE1hdGgubWluKG1heCwgdmFsdWUpKQogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZVN3aXRjaChudW1iZXI6IG51bWJlcikgewogICAgICAgIGJvb2tTaGVsZi5tYXAoKGJvb2ssIGluZGV4KSA9PiB7CiAgICAgICAgICAgIGJvb2suYm9vay50cmFuc2xhdGVYKAogICAgICAgICAgICAgICAgLShudW1iZXIgLSBpbmRleCkgKiBpbm5lcldpZHRoICogU3BhY2VyIC0gYm9vay5ib29rLnBvc2l0aW9uLngsCiAgICAgICAgICAgICkKICAgICAgICAgICAgYm9vay50YXBlPy50cmFuc2xhdGVYKAogICAgICAgICAgICAgICAgLShudW1iZXIgLSBpbmRleCkgKiBpbm5lcldpZHRoICogU3BhY2VyIC0gYm9vay50YXBlLnBvc2l0aW9uLngsCiAgICAgICAgICAgICkKICAgICAgICAgICAgY291bnRlckJ1ZmZlcgogICAgICAgICAgICAgICAgLnNsaWNlKGluZGV4ICogMywgaW5kZXggKiAzICsgMykKICAgICAgICAgICAgICAgIC5tYXAoKGVudHJ5LCBlbnRyeUluZGV4KSA9PgogICAgICAgICAgICAgICAgICAgIGVudHJ5LnRyYW5zbGF0ZVgoCiAgICAgICAgICAgICAgICAgICAgICAgIC0obnVtYmVyIC0gaW5kZXgpICogaW5uZXJXaWR0aCAqIFNwYWNlciArCiAgICAgICAgICAgICAgICAgICAgICAgIChlbnRyeUluZGV4IC0gMSkgKiAoMiAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKSAqIDMwIC0KICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkucG9zaXRpb24ueCwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgKQogICAgICAgIH0pCiAgICAgICAgc3RhZ2U/LnJlbmRlcigpCiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlU2Nyb2xsKGluZGV4OiBudW1iZXIpIHsKICAgICAgICBib29rU2hlbGZbaW5kZXhdLnRhcGU/LnRyYW5zbGF0ZVkoCiAgICAgICAgICAgIHNjcm9sbGVyc1tpbmRleF0gLyAzIC0gYm9va1NoZWxmW2luZGV4XS50YXBlLnBvc2l0aW9uLnksCiAgICAgICAgKQogICAgICAgIGJvb2tTaGVsZltpbmRleF0uYm9vay5yb3RhdGVYKAogICAgICAgICAgICAoKHNjcm9sbGVyc1tpbmRleF0gLyA4IC0gNDApICogTWF0aC5QSSkgLyAzNjAgLQogICAgICAgICAgICBib29rU2hlbGZbaW5kZXhdLmJvb2sucm90YXRpb24ueCwKICAgICAgICApCiAgICAgICAgYm9va1NoZWxmW2luZGV4XS5ib29rLnRyYW5zbGF0ZVkoCiAgICAgICAgICAgIC1jbGFtcCgtc2Nyb2xsZXJzW2luZGV4XSAvIDMuNSAtIDUsIC01MCwgLTEyLjUpIC0KICAgICAgICAgICAgYm9va1NoZWxmW2luZGV4XS5ib29rLnBvc2l0aW9uLnksCiAgICAgICAgKQogICAgICAgIGNvbnN0IGFwcGx5Qm9va1Njcm9sbFNjYWxlID0gTWF0aC5tYXgoCiAgICAgICAgICAgIDEgLSBzY3JvbGxlcnNbaW5kZXhdIC8gKGlubmVySGVpZ2h0IC8gMy41KSwKICAgICAgICAgICAgMC41LAogICAgICAgICkKICAgICAgICBib29rU2hlbGZbaW5kZXhdLmJvb2suc2NhbGUuc2V0KAogICAgICAgICAgICBhcHBseUJvb2tTY3JvbGxTY2FsZSwKICAgICAgICAgICAgYXBwbHlCb29rU2Nyb2xsU2NhbGUsCiAgICAgICAgICAgIGFwcGx5Qm9va1Njcm9sbFNjYWxlLAogICAgICAgICkKICAgICAgICBjb3VudGVyQnVmZmVyCiAgICAgICAgICAgIC5maWx0ZXIoKHgsIGkpID0+IGkgJSAzID09PSAxKQogICAgICAgICAgICBbaW5kZXhdLnNjYWxlLnNldChvdXR0YVNjYWxlW2luZGV4XSwgb3V0dGFTY2FsZVtpbmRleF0sIDEpCgogICAgICAgIHN0YWdlPy5yZW5kZXIoKQogICAgfQoKICAgIG9uTW91bnQoKCkgPT4gewogICAgICAgIGZldGNoQm9vaygnL2dpc3QvU3RldmVuUkNFMC9hNjg0NjA0MjI5MzdmMTgyYmM1OTE3ODhmYTMwZTkzMC9yYXcnKS50aGVuKAogICAgICAgICAgICAoYm9va3MpID0+IHsKICAgICAgICAgICAgICAgIGJvb2tzLm1hcChhc3luYyAoYm9va0luZm9ybWF0aW9uLCBib29rSW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdCb29rID0gbmV3IEJvb2tsZXQoYm9va0luZm9ybWF0aW9uKQogICAgICAgICAgICAgICAgICAgIHNjcm9sbGVycy5wdXNoKDApCiAgICAgICAgICAgICAgICAgICAgZmlndXJlID0gbmV3IENvdW50ZXIoYm9va3MubGVuZ3RoLCBib29rSW5kZXggKyAxLCAwLjc1KQogICAgICAgICAgICAgICAgICAgIGJvb2tTaGVsZiA9IFsuLi5ib29rU2hlbGYsIHsgYm9vazogbmV3Qm9vay5ib29rIH1dCiAgICAgICAgICAgICAgICAgICAgY291bnRlckJ1ZmZlciA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgLi4uY291bnRlckJ1ZmZlciwKICAgICAgICAgICAgICAgICAgICAgICAgZmlndXJlLmRpZ2l0Q3VycmVudCwKICAgICAgICAgICAgICAgICAgICAgICAgZmlndXJlLm91dE9mLAogICAgICAgICAgICAgICAgICAgICAgICBmaWd1cmUuZGlnaXRUb3RhbCwKICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgbmV3Qm9vay5ib29rLnJvdGF0ZVgoCiAgICAgICAgICAgICAgICAgICAgICAgICgtNDAgKiBNYXRoLlBJKSAvIDM2MCAtIG5ld0Jvb2suYm9vay5yb3RhdGlvbi54LAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBuZXdCb29rLmJvb2sudHJhbnNsYXRlWSgxNSkKICAgICAgICAgICAgICAgICAgICBuZXdCb29rLmJvb2sudHJhbnNsYXRlWigtNSkKICAgICAgICAgICAgICAgICAgICBmaWd1cmUuZGlnaXRDdXJyZW50LnRyYW5zbGF0ZVgoCiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2tJbmRleCAqIGlubmVyV2lkdGggKiBTcGFjZXIsCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGZpZ3VyZS5kaWdpdFRvdGFsLnRyYW5zbGF0ZVgoCiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2tJbmRleCAqIGlubmVyV2lkdGggKiBTcGFjZXIsCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGZpZ3VyZS5vdXRPZi50cmFuc2xhdGVYKGJvb2tJbmRleCAqIGlubmVyV2lkdGggKiBTcGFjZXIpCiAgICAgICAgICAgICAgICAgICAgZmlndXJlLmRpZ2l0Q3VycmVudC50cmFuc2xhdGVYKAogICAgICAgICAgICAgICAgICAgICAgICAoMiAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKSAqIC0zMCwKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgZmlndXJlLmRpZ2l0Q3VycmVudC50cmFuc2xhdGVZKAogICAgICAgICAgICAgICAgICAgICAgICA0MCAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvICsgaW5uZXJIZWlnaHQgKiAwLjA2LAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBmaWd1cmUuZGlnaXRDdXJyZW50LnRyYW5zbGF0ZVooCiAgICAgICAgICAgICAgICAgICAgICAgICgyIC8gd2luZG93LmRldmljZVBpeGVsUmF0aW8pICogLTc1LAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBmaWd1cmUuZGlnaXRUb3RhbC50cmFuc2xhdGVYKAogICAgICAgICAgICAgICAgICAgICAgICAoMiAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKSAqIDMwLAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBmaWd1cmUuZGlnaXRUb3RhbC50cmFuc2xhdGVZKAogICAgICAgICAgICAgICAgICAgICAgICA0MCAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvICsgaW5uZXJIZWlnaHQgKiAwLjA2LAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBmaWd1cmUuZGlnaXRUb3RhbC50cmFuc2xhdGVaKAogICAgICAgICAgICAgICAgICAgICAgICAoMiAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKSAqIC03NSwKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgZmlndXJlLm91dE9mLnRyYW5zbGF0ZVkoCiAgICAgICAgICAgICAgICAgICAgICAgIDEwMCAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvICsgaW5uZXJIZWlnaHQgKiAwLjA0LAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBmaWd1cmUub3V0T2YudHJhbnNsYXRlWigKICAgICAgICAgICAgICAgICAgICAgICAgKDIgLyB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbykgKiAtMTE1LAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBuZXdCb29rLmJvb2sudHJhbnNsYXRlWChib29rSW5kZXggKiBpbm5lcldpZHRoICogU3BhY2VyKQogICAgICAgICAgICAgICAgICAgIGl0ZW1CdWZmZXIgPSBbLi4uaXRlbUJ1ZmZlciwgbmV3Qm9vay5ib29rXQogICAgICAgICAgICAgICAgICAgIG5ld0Jvb2suY292ZXJMb2FkZWQudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWdlLmRlZXBSZW5kZXIoKQogICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIG5ld0Jvb2sudGFwZS50aGVuKCh0YXBlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcGUudHJhbnNsYXRlWigtMjApCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcGUudHJhbnNsYXRlWChib29rSW5kZXggKiBpbm5lcldpZHRoICogU3BhY2VyKQogICAgICAgICAgICAgICAgICAgICAgICBib29rU2hlbGZbYm9va0luZGV4XS50YXBlID0gdGFwZQogICAgICAgICAgICAgICAgICAgICAgICBpdGVtQnVmZmVyID0gWy4uLml0ZW1CdWZmZXIsIHRhcGVdCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBzdGFnZT8ucmVuZGVyKCkKICAgICAgICAgICAgfSwKICAgICAgICApCiAgICB9KQo=">{}</script>

<svelte:head>
    <title>Bookshelf</title>
</svelte:head>
<main>
    {#if loading}
        <div id='LoadingPlaceholder' in:fade out:fade>
            Loading
            <br />
            <span id='SwipeIndicator'>Swipe to go for the next book</span>
        </div>
    {/if}
    <div
        id='BookshelfStage'
        use:watchResize={() => {
            // book.resize()
            stage.deepRender()
        }}
    >
        <CentreStage
            objects={[...itemBuffer, ...counterBuffer]}
            bind:this={stage}
        />
    </div>
    <Swiper
        spaceBetween={0}
        slidesPerView={1}
        shortSwipes={true}
        edgeSwipeDetection={"prevent"}
        mousewheel={{ forceToAxis: true, thresholdDelta: 20 }}
        keyboard={{ enabled: true }}
        modules={[Mousewheel, Keyboard]}
        style='width: 100vw;'
        on:slideChange={(e) => {
            fineOffset.set(e.detail[0][0].activeIndex)
        }}
    >
        {#each bookShelf as book, i}
            <SwiperSlide>
                <div
                    class='tall'
                    id={`book-${i}`}
                    bind:this={scrollingBlocks[i]}
                    on:scroll={(e) => {
                        // @ts-ignore
                        scrollers[i] = e.target.scrollTop
                        handleScroll(i)
                    }}
                >
                    <div
                        style='height: calc(100vh + 500pt);'
                        bind:this={scrollingBlocks[i]}
                    />
                </div>
            </SwiperSlide>
        {/each}
    </Swiper>
</main>

<style ✂prettier:content✂="CiAgICBtYWluIHsKICAgICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgICAgaGVpZ2h0OiAwOwogICAgICAgIHdpZHRoOiAwOwogICAgICAgIG92ZXJmbG93OiB2aXNpYmxlOwogICAgfQoKICAgIC50YWxsIHsKICAgICAgICBoZWlnaHQ6IDEwMHZoOwogICAgICAgIG92ZXJmbG93LXk6IHNjcm9sbDsKICAgICAgICAtbXMtb3ZlcmZsb3ctc3R5bGU6IG5vbmU7IC8qIElFIGFuZCBFZGdlICovCiAgICAgICAgc2Nyb2xsYmFyLXdpZHRoOiBub25lOyAvKiBGaXJlZm94ICovCiAgICB9CgogICAgLnRhbGw6Oi13ZWJraXQtc2Nyb2xsYmFyIHsKICAgICAgICBkaXNwbGF5OiBub25lOwogICAgfQoKICAgICNCb29rc2hlbGZTdGFnZSB7CiAgICAgICAgei1pbmRleDogMDsKICAgIH0KCiAgICAjTG9hZGluZ1BsYWNlaG9sZGVyIHsKICAgICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgICAgdG9wOiA1MCU7CiAgICAgICAgbGVmdDogNTAlOwogICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgICAgIGZvbnQtc2l6ZTogMzNwdDsKICAgICAgICBmb250LXdlaWdodDogbGlnaHRlcjsKICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgY29sb3I6ICM2NjY7CiAgICAgICAgei1pbmRleDogMTsKICAgIH0KCiAgICAjU3dpcGVJbmRpY2F0b3IgewogICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgIGZvbnQtc2l6ZTogMjNwdDsKICAgICAgICBhbmltYXRpb246IFN3aXBlSW5kaWNhdGlvbiAwLjg1cyBjdWJpYy1iZXppZXIoMC4xNzUsIDAuODg1LCAwLjMyLCAxLjI3NSkgMC41cyBmb3J3YXJkczsKICAgIH0KCiAgICBAa2V5ZnJhbWVzIFN3aXBlSW5kaWNhdGlvbiB7CiAgICAgICAgMCUgewogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCk7CiAgICAgICAgfQogICAgICAgIDUwJSB7CiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtMTBweCk7CiAgICAgICAgfQogICAgICAgIDEwMCUgewogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCk7CiAgICAgICAgfQogICAgfQo="></style>